
# Upstream kernel

| Kernel Version | Feature | Required userspace version and notes |
|----------------|---------|--------------------------------------|
| 2.6.36         | Base functionality lands upstream mediation of<sup>1</sup>: <ul><li>File<ul><li>owner conditional</li><li>read, write, link, lock, mmap exec</li></ul></li><li>Execute<ul><li>[pP]x, [cC]x, ix, ux, [pP]ix, [pP]ux named transitions</li><li>attachment conditional separate from profile name</li></ul></li><li>Change hat<ul><li>single hat</li></ul></li><li>Change Profile</li><li>Capability</li><li>policy namespaces created through policy load</li><li>rlimit</li><li>Bug fixes and code cleanups</li></ul> | ```1``` AppArmor 2.5.1 |
| 2.6.37 - 3.3| Bug fixes and code cleanups       |  |
| 3.4            | <ul><li>Add support for extensible policydb<sup>1</sup></li><li>feature set<ul><li>add <i>features/</i> directory as a userspace api to discover kernel supported feature set</li><li>add file mediation details</li><li>add capability mediation details</li><li>export known rlimit mappings</li></ul></li></ul>       | ```1``` AppArmor 2.8 |
| 3.5            | Fail exec transitions due to no_new_privs<ul><li>unconfined is allowed to transition to anything</li><li>inherit is allowed when task has nnp set</li><li>all other domain transitions are blocked when a task has nnp set</li><li>Bug fixes and code cleanups</li></ul>        |  |
| 3.6 - 3.10     | Bug fixes and code cleanups       |  |
| 3.11           | <ul><li>relax restrictions on setting rlimits</li> <li>Bug fixes and code cleanups</li></ul>   |  |
| 3.12           | <ul><li>support unconfined flag on any profile<sup>4</sup></li><li>support multiple profiles being loaded in a single write<sup>1</sup></li><li>introspection interface<ul><li>add ability to query whether apparmor is enabled<sup>?</sup></li><li>allow introspecting the loaded set of profiles virtualized to the opening tasks namespace via the <i>profiles</i> file<sup>?</sup></li><li>add <i>policy/</i> directory which can be used to introspect profiles and namespaces of loaded policy<sup>?</sup><ul><li> add <i>policy/namespaces/</i> dir to introspect policy namespaces</li><li>add <i>policy/profiles/</i> dir to report on profiles loaded into the current namespace<ul><li>report profile name <i>policy/profiles/PROFILE/name</i></li><li>report profile mode <i>policy/profiles/PROFILE/mode</i></li><li>report sha1 of profile <i>policy/profiles/PROFILE/sha1</i></li><li>allow human readable attachment string to be loaded and reported in the <i>policy/profiles/PROFILE/attach</i></li></ul></li></ul></li></ul></li><li>feature set<ul><li>export set of capabilities supported</li></ul></li><li>Bug fixes and code cleanups</li></ul>   | ```1``` AppArmor 2.10<br>```2``` ???<br>```3``` ????<br>```4``` AppArmor 3.0  |
| 3.13 - 4.7       | Bug fixes and code cleanups       |   |
| 4.8            | <ul><li>allow CAP_SYS_RESOURCE to prlimit another task</li><li>add kernel parameter and kconfig to allow controlling if profile hashing is used</li><li>Bug fixes and code cleanups</li></ul>        |   |
| 4.9 - 4.10     | Bug fixes and code cleanups     |   |
| 4.11           | <ul><ul><li>add <i>/sys/kernel/security/lsm</i> to enable detecting currently in use lsm</li><li>kernel parameters<ul><li>remove paranoid load parameter - all policy loads now do full checking</li></ul></li><li>speedup mediation by use of percpu buffers</li><li>add sysctl <i>/proc/sys/kernel/unprivileged_userns_apparmor_policy</i> to allow disabling user namespaces from loading policy</li><li>add query interface for extended profile <i>key,value</i> data store<sup>1</sup></ul><li>allow profile hashing to be disabled with a kconfing<sup>2</sup></li><li>policy namespaces<ul><li>add namespace view support and restrictions on visibility</li><li>add per namespace policy interface file to directly load policy into a namespace<ul><li><i>policy/namespaces/NAMESPACE/.load</i></li><li><i>policy/namespaces/NAMESPACE/.replace</i></li><li><i>policy/namespaces/NAMESPACE/.remove</i></li></ul></li></ul></li><li>allow introspecting and checkpoint and restore of loaded profile data via<ul><li><i>policy/profiles/PROFILE/raw_abi</i></li><li><i>policy/profiles/PROFILE/raw_data</i></li><li><i>policy/profiles/PROFILE/raw_sha1</i></li></ul></li><li> on exec dup2 opened files that the task won't have permission to access to a special <i>.null</i> device file<sup>3</sup></li><li>Complain mode<ul><li>support force complain flag<sup>1</sup></li><li>try to create null profiles using the exec name <i>null-EXECNAME</i><sup></sup></ul></li><li>feature set<ul><li> add <i>features/domain/fix_binfmt_elf_mmap</i> to enable userspace to detect the semantic change caused by <i>9f834ec18def</i></li></ul></li><li>report namespace name in audit messages</li><li>Bug fixes and code cleanups</li></ul>        |  ```1``` AppArmor 3.0<br>```2``` Disables kernel profile load dedup to improve initial profile load performance<br>```3``` Does not change file access permissions, just where the check is done. Can result in mediation that would not occur under the old scheme due to some inherited fds never being accessed.<br>```4``` gen/logprof support???<br> |
| 4.12           | <ul><li>kernel parameters<ul><li>make path_max readonly</li></ul></li><li>Bug fixes and code cleanups</li></ul>        |   |
| 4.13           | <ul><li>add v7 abi<sup>1</sup></li><li>speedup path lookups with preallocated buffers</li><li>revalidate files at exec transition time</li><li>fine grained ptrace mediation</li><li>domain bounding through profile stacking<sup>1</sup><ul><li>profile stacking api</li><li>extended change_profile to support profile stacking</li><li>support profile stacks in exec transitions</li><li>nnp restrictions loosened to any transition that is a strict subset. New profiles can be added to the stack but profiles can not be transitioned.</li></ul></li><li>apparmorfs interface<ul><li> apparmorfs policy virtualization<ul><li>the <i>policy/</i> entry is now a special symlink to a virtualized policy directory</li><li><i>policy/</i> directory is now virtualized based on opening task confinement so tasks can only see the subset of policy in their view</li></ul></li> <li>add namespace level rawdata files<ul><li>unique profile based rawdata files for each namespace in <i>policy/raw_data/</i></li><li> profile raw_data files are now a symlink to the appropriate <i>policy/raw_data/</i> files.</li></ul></li><li>mkdir/rmdir fs based interface for creating namespaces<ul><li>mkdir <i>policy/namespaces/NAMESPACE</i></li><li>rmdir policy/namespaces/NAMESPACE</li></ul></li><li>revision file interface<sup>2</sup><ul><li>read current policy revision and select/poll for when policy changes via<ul><li> <i>revision</i> for reading the current task's policy namespace revision</li><li><i>policy/revision for the current namespace revision</li><li><i>policy/namespaces/NAMESPACE/revision</i> for a given namespace policy revision</li></ul></li></ul></li><li>query interface<ul><li>support multiple queries per query transaction<sup>3</sup></li><li>support querying if a profile supports a given mediation type<sup>4</sup></li></ul></li></ul></li><li>features set<ul><li>add namespace support to available feature set</li><li>add label data query availability to feature set</li></ul></li><li>Bug fixes and code cleanups</li></ul>     | ```1``` AppArmor 2.10<br>```2``` library interface added to AppArmor 3.0, can be used directly with any version apparmor<br>```3``` AppArmor 3.0<br>```4``` AppArmor 3.0???? |
| 4.14           | <ul><li> mount mediation<sup>1</sup><ul><li>new mount</li><li>remount</li><li>bind mount</li><li>change type</li><li>umount</li><li>pivot_root</li></ul><li>signal mediation<sup>2</sup></li><li>policy unpack log extended error messages</li><li>Bug fixes and code cleanups</li></ul> | ```1``` AppArmor 2.8<br>```2``` AppArmor 2.9  |
| 4.15 - 4.16 | Bug fixes and code cleanups|   |
| 4.17           | <ul><li> v8 abi<sup>1</sup></li><li>generic socket mediation (ie. basic network mediation)<sup>1</sup></li><li>improved profile attachment logic<ul><li>handle overlapping expression resolution up to 8 characters dynamic overlap in kernel<sup>2</sup></li><li>xattr attachment conditional<sup>1</sup></li><li>no_new_privs improved attachment with subset test based on confinement at time no_new_privs was entered<sup>3</sup></ul></li><li> signal mediation of profile stacks<sup>4</sup></li><li>Bug fixes and code cleanups</li></ul>       | ```1``` AppArmor 3.0 and requires policy using feature abi rules<br>```2``` Any userspace that supports attachment conditionasl 2.5+<br>```3``` no userspace requirements, reduces cases where nnp prevents a transition<br>```4```Same userspace as regular signal mediation AppArmor 2.9  |
| 4.18           | <ul><li>add support for secids and using secctxes</li><li>the ability to get a task's secid</li><li>add support for audit rules filtering. AppArmor task label can be used in audit rule filters</li><li>Bug fixes and code cleanups</li></ul>        | No apparmor userspace requirements.  |
| 4.19           | Bug fixes and code cleanups|   |
| 4.20           | <ul><li>Secmark mediation for custom policy<sup>1</sup></li><li>Bug fixes and code cleanups</li></ul> | ```1``` Custom patch not in upstream apparmor |
| 5.0            | Bug fixes and code cleanups|    |
| 5.1            | <ul><li>LSM stacking with generic blobs (sara/landlock). Does not include secids so insufficient to stack with selinux and smack.</li><li>Bug fixes and code cleanups</li></ul> | no userspace requirements. There is a new kernel parameter <i>lsm=</i> that is used in place of the old <i>security=</i> parameter  |
| 5.2            | wip <ul><li>fine grained af_unix mediation<ul><li>unix rules<sup>1</sup></li><li>get peer sock label via so_peersec<sup>2</sup><li><li>dbus mediation<sup>3</sup></li></ul></li><li>no-new-privs rules</li></ul>   | ```1``` AppArmor 3.0<br>```2```No userspace support needed to read via getsockopt. Library support for ```aa_getpeercon``` add in AppArmor 2.7<br>```3``` requires AppArmor 3.0 and D-Bus 1.10.0</li></ul>

# Suse kernel

# Ubuntu Kernel
